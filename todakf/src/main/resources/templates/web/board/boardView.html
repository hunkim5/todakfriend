<!DOCTYPE html>
<html lang="ko"
		xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout/web_layout}">


<th:block layout:fragment="content">
<div class="border rounded text-center px-2 mt-2 mb-3"
     style="background-color: #fafafa; font-size: 0.85rem; padding-top: 0.9rem; padding-bottom: 1.0rem;">
  <div class="mb-2">
    <a href="list?boardGubun=free" class="mx-2 text-dark text-decoration-none" th:classappend="${param.boardGubun.contains('free')} ? ' active' : ''">ììœ ê²Œì‹œíŒ</a> |
    <a href="list?boardGubun=qna" class="me-2 text-dark text-decoration-none" th:classappend="${param.boardGubun.contains('qna')} ? ' active' : ''">ì§ˆë¬¸&ë‹µë³€</a> |
    <a href="list?boardGubun=review" class="mx-2 text-dark text-decoration-none" th:classappend="${param.boardGubun.contains('review')} ? ' active' : ''">ì´ìš©í›„ê¸°</a>
  </div>
</div>

    <div class="boards">
  <div class="board">
    <div class="board-header">
    </div>

    <div class="mb-3">
      <h4 style="font-size: 1.1rem; font-weight: bold;" th:text="${data.title}">ğŸ°ì•„ì´ìŠ¤í¬ë¦¼( ì¹´í†¡ ice4477 )ğŸ¦ ì¸ê¸°ë§¤ë‹ˆì € ë³´ìœ ...</h4>
      <div class="post-meta">
        <span class="author" th:text="${data.nickname+' Â· '+data.createDt}">ìŠˆí¼ë§¨ Â· 05/08</span>
        <span class="stats" th:text="${'ì¡°íšŒ '+data.searchCnt+' Â· ì¶”ì²œ '+data.likeCnt}">ì¡°íšŒ 52 Â· ì¶”ì²œ 1</span>
      </div>
    </div>

    <div class="mb-4" style="white-space: pre-wrap; font-size: 0.95rem; line-height: 1.6;" th:utext="${data.content ?: ''}">
      ì•„ì´ìŠ¤í¬ë¦¼( ì¹´í†¡ ice4477 ) ì¸ê¸°ë§¤ë‹ˆì € ë³´ìœ ... <br>
      ë‹¤ì–‘í•œ ì—­í• ëŒ€í–‰ ì„œë¹„ìŠ¤ ì œê³µ ì¤‘ì…ë‹ˆë‹¤.<br>
      í”„ë¼ì´ë²„ì‹œ 100% ë³´ì¥, ë¹ ë¥¸ ë§¤ì¹­ ë³´ì¥í•©ë‹ˆë‹¤.<br>
      ë¬¸ì˜ì£¼ì„¸ìš”!
    </div>

    <div class="mb-4 d-flex justify-content-between align-items-center">
	  <div>
	    <button class="btn btn-outline-danger btn-sm" id="likeBtn" th:if="${session.loginUser?.userSeq}">
	      â¤ï¸ ì¶”ì²œ <span id="likeCount" th:text="${data.likeCnt}">1</span>
	    </button>
	  </div>
	  <div>
	  <span th:if="${session.loginUser?.userSeq}">
	    <button class="btn btn-sm btn-outline-primary me-2" onclick="changeView('/web/board/saveForm')" th:if="${session.loginUser.userSeq==data.userSeq}">ìˆ˜ì •</button>
	    <button class="btn btn-sm btn-outline-danger" th:if="${session.loginUser.userSeq==data.userSeq}">ì‚­ì œ</button>
	  </span><span>
	    <button class="btn btn-sm btn-outline-primary me-2" onclick="changeView('/web/permit/board/list')">ëª©ë¡</button>
	   <th:block th:if="${session.loginUser?.userSeq}">
		<button class="btn btn-sm btn-outline-secondary" onclick="openReportModal()">
		  ğŸš¨
		</button>
	   </th:block>
	   </span>
	  </div>
	</div>

    <hr>

    <div class="mb-3">
      <h5 style="font-size: 1rem;">ğŸ’¬ ëŒ“ê¸€ (<th:block th:text="${commentCount}"/>)</h5>
    </div>
	<form id="commentFrm" class="mb-4" th:if="${session.loginUser?.userSeq}">
	<input type="hidden" name="boardSeq" th:value="${data.boardSeq}" />
      <textarea class="form-control mb-2" rows="2" name="content" id="content"  placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
      <div class="text-end">
        <button type="submit" class="btn btn-sm btn-primary">ë“±ë¡</button>
      </div>
    </form>
    <div class="mb-3" style="font-size: 0.9rem;" id="commentList">
      <div class="border rounded p-2 mb-2" th:each="comment : ${commentList}" th:style="'margin-left: ' + ${comment.depth * 10} + 'px;'" th:classappend="${comment.depth>0} ? 'bg-white' : 'bg-light'">
      	<div style="margin-bottom:5px;">
	        <span th:text="${comment.depth>0}? |â¤·${comment.nickname}| : ${comment.nickname}" style="font-size: 0.80rem;font-weight: bold;">í™ê¸¸ë™</span> Â·
	        <span th:text="${comment.createDtm}" style="font-size: 0.85rem;">05/08</span><br>
        </div>
        <div th:utext="${comment.content}">ì •ë§ ì¢‹ì€ ì •ë³´ ê°ì‚¬í•©ë‹ˆë‹¤!</div>
        <div th:if="${session.loginUser?.userSeq}">
		    <a href="javascript:void(0)" class="comment-action" th:onclick="'replyComment(' + ${comment.commentSeq} + ',this)'">ë‹µê¸€</a>
		    <a href="#" class="comment-action comment-delete" th:onclick="'deleteComment(' + ${comment.commentSeq} + ')'" th:if="${session.loginUser.userSeq==data.userSeq}">ì‚­ì œ</a>
		</div>
      </div>
    </div>

  </div>
</div>

<div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reportModalLabel" style="font-size: 0.9rem;font-weight: bold;">ì´ ê²Œì‹œê¸€ì— ì–´ë–¤ ë¬¸ì œê°€ ìˆë‚˜ìš”?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <textarea class="form-control" id="complainContent" rows="3" placeholder="ì‹ ê³  ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                <button type="button" class="btn btn-danger" id="saveComplain">ì‹ ê³ í•˜ê¸°</button>
            </div>
        </div>
    </div>
</div>
<form id="dataForm" method="post">
<input type="hidden" name="page" id="page" th:value="${param.page}" />
<input type="hidden" name="boardGubun" th:value="${param.boardGubun}">
<input type="hidden" name="boardSeq" id="boardSeq" th:value="${param.boardSeq}"/>
<input type="hidden" name="uuid" th:value="${data.uuid}">
<input type="hidden" name="parentSeq" id="parentSeq">
</form>
</th:block>
<th:block layout:fragment="script">
<script>
function changeView(val){
	$("#dataForm").attr("action",val);
	$("#dataForm").submit();
}

$(document).ready(function() {
	$('#likeBtn').click(function () {
	    let formData = $("#dataForm").serialize();
		$.ajax({
	        url: "/web/updateLikeCnt",
	        data : formData,
	        type: "POST",
	        success: function(res) {
	        	console.log(">>>res:"+res);
	        	if(res ==0){
	        		alert("ì¶”ì²œ ë˜ì—ˆìŠµë‹ˆë‹¤.");
		        	let cnt = Number($("#likeCount").html());
		        	$("#likeCount").html(cnt+1);
	        	}else{
	        		alert("ì´ë¯¸ ì¶”ì²œ í•˜ì…¨ìŠµë‹ˆë‹¤.");
	        	}
	        },
	        error: function(response) {
	        }
	    });
	 });
	$('#saveComplain').click(function () {
		let formData = $("#dataForm").serialize();
		formData += "&content="+$("#complainContent").val();
		$.ajax({
	        url: "/web/saveComplain",
	        data : formData,
	        type: "POST",
	        success: function(res) {
	        	if(res ==0){
		        	alert("ì‹ ê³  ë˜ì—ˆìŠµë‹ˆë‹¤.");
	        	}else{
	        		alert("ì´ë¯¸ ì‹ ê³  í•˜ì…¨ìŠµë‹ˆë‹¤.");
	        		$("#complainContent").val('');
	        	}
	        	myModal.hide();
	        },
	        error: function(response) {
	        }
	    });
	 });
	$('#commentFrm').on('submit', function (e) {
	    e.preventDefault();
	    sessionStorage.setItem('scrollPosition', $(window).scrollTop());
	    $.ajax({
	        type: 'POST',
	        url: '/web/board/insertBoardComment',  // Spring ì»¨íŠ¸ë¡¤ëŸ¬ URL
	        data: $(this).serialize(), // name ì†ì„± ê¸°ë°˜ìœ¼ë¡œ ì „ì†¡
	        success: function(res) {
	        	location.reload();
	        },
	        error: function(xhr) {
	          alert('ì „ì†¡ ì‹¤íŒ¨: ' + xhr.responseText);
	        }
	   	});
	}); //~ajax
});
var myModal;
function openReportModal() {
  myModal = new bootstrap.Modal(document.getElementById('reportModal'));
  myModal.show();
}
function deleteComment(seq){
	if(!confirm("ì‚­ì œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))return;
	$.ajax({
        url: "/web/deleteBoardComment",
        data : "commentSeq="+seq,
        type: "POST",
        success: function(res) {
        	location.reload();
        },
        error: function(response) {
        }
    });
}
 </script>
</th:block>