<!DOCTYPE html>
<html lang="ko"
		xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout/admin_layout}">

<th:block layout:fragment="script">
<script>
$(document).ready(function(){
	$("#searchOption").val("[[${param.searchOption}]]");
});
function changeView(val,id){
	$("#complainSeq").val(id);
	$("#searchFrm").attr("action",val);
	$("#searchFrm").submit();
}
function goList(page){
	$("#page").val(page);
	$("#searchFrm").attr("action","list");
	$("#searchFrm").submit();
}
function updateBlindYn(blindYn,val){
	// í¼ ì œì¶œ ì „ì— í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì €ì¥
    sessionStorage.setItem('scrollPosition', $(window).scrollTop());
	let uuid = val.dataset.uuid;
	let tablename = val.dataset.tablename;
	let arr ={
			uuid :uuid,
			tableName : tablename,
			blindYn : blindYn
	}
	$.ajax({
        url: "/admin/complain/updateBlindYn",
        type: "POST",
        data: JSON.stringify(arr),
        contentType : "application/json; charset=UTF-8",
        success: function(response) {
            alert("ì²˜ë¦¬ ë˜ì—ˆìŠµë‹ˆë‹¤.");
            location.reload();
        },
        error: function(response) {
        	console.log(response.responseText);
        }
    });
}
</script>
</th:block>
<th:block layout:fragment="content">
	<div class="card-header">
      <span th:text="${param.complainTitle}"></span>
    </div>

	<form id="searchFrm" method="post" action="list" class="mt-4 mb-3">
	<input type="hidden" name="page" id="page" th:value="${param.page}" />
	<input type="hidden" name="complainSeq" id="complainSeq" />

	 <div class="d-flex flex-wrap justify-content-between align-items-center">
	    <div class="d-flex flex-wrap gap-2 align-items-center">
	      <select class="form-select form-select-sm" style="width: 120px;" name="searchOption" id="searchOption">
	        <option value="">ì„ íƒ</option>
	        <option value="nickname">ì‹ ê³ ì</option>
	        <option value="targetNickname">ì‹ ê³ ëœì</option>
	        <option value="title">ì‹ ê³ ëœê¸€</option>
	        <option value="content">ì‹ ê³ ë‚´ìš©</option>
	      </select>
	      <input type="text" class="form-control form-control-sm" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" style="width: 200px;" name="searchText" th:value="${param.searchText}">
	      <button class="btn btn-sm btn-outline-secondary" type="submit">ê²€ìƒ‰</button>
	    </div>
	  </div>

	</form>

	<table class="table table-hover mt-2 ">
		<!-- <colgroup>
			<col width="5%">
			<col width="40%">
			<col width="10%">
			<col width="5%">
			<col width="5%">
			<col width="15%">
		</colgroup> -->
		<thead class="table-dark">
			<tr>
				<th>No</th>
                <th>ì¶œì²˜</th>
                <th>ì‹ ê³ ëœê¸€</th>
                <th>ì‹ ê³ ë‚´ìš©</th>
                <th>ì‹ ê³ ì</th>
                <th>ì‹ ê³ ëœì</th>
                <th>ì‹ ê³ ì¼</th>
                <th></th>
			</tr>
		</thead>
		<tbody>
			<tr th:each="data,stat : ${list}">
				<td th:text="${stat.index+ (page.offset+1)}"></td>
				<td th:text="${data.boardGubunName}" style="text-align: center;"></td>
				<td th:text="${data.title}" >ì‹ ê³ ëœê¸€</td>
				<td th:title="${data.content}" style="text-align:left;">
					<p style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 500px;">
					  [[${data.content}]]
					</p>
				</td>
				<td th:text="${data.nickname}" class="text-center">ì‹ ê³ ì</td>
				<td th:text="${data.targetNickname}" >ì‹ ê³ ëœì</td>
				<td th:text="${#temporals.format(data.createDtm, 'yyyy-MM-dd HH:mm:ss')}" >ì‹ ê³ ì¼</td>
				<td>
					<th:block th:if="${data.blindYn==1}">
						<button class="btn btn-danger btn-sm" type="button" th:data-uuid="${data.uuid}" th:data-tablename="${data.tableName}" onclick="updateBlindYn(0,this)">ë¸”ë¼ì¸ë“œí•´ì œ</button>
					</th:block>
					<th:block th:if="${data.blindYn==0}">
						<button class="btn btn-primary btn-sm" type="button" th:data-uuid="${data.uuid}" th:data-tablename="${data.tableName}" onclick="updateBlindYn(1,this)">ë¸”ë¼ì¸ë“œì²˜ë¦¬</button>
					</th:block>
				</td>
			</tr>
			<tr th:if="${#lists.isEmpty(list)}">
				<td colspan="6" class="text-center">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
			</tr>
		</tbody>
	</table>
	<!-- ğŸ”¹ í˜ì´ì§• -->
	<nav class="d-flex justify-content-center mt-3">
		<ul class="pagination pagination-sm">
			<li class="page-item disabled" th:if="${page.hasPrevBlock}">
				<a class="page-link" href="#" th:onclick="'goList(\'' + ${page.startBlock - 1} + '\')'">ì´ì „</a>
			</li>
			<th:block th:if="${page.endBlock>0}">
				<li class="page-item " th:each="i : ${#numbers.sequence(page.startBlock, page.endBlock)}"
            th:classappend="${i == page.page} ? 'active'">
					<a class="page-link" href="#" th:onclick="'goList(\'' + ${i} + '\')'" th:text="${i}">1</a>
				</li>
			</th:block>
			<li class="page-item" th:if="${page.hasNextBlock}">
				<a class="page-link" href="#" th:onclick="'goList(\'' + ${page.endBlock + 1} + '\')'">ë‹¤ìŒ</a>
			</li>
		</ul>
	</nav>
</th:block>